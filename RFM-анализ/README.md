<h2 align="center">RFM-анализ клиентской базы аптечной сети </a>
<h3 align="center">Цель исследования: </h3>
&nbsp;&nbsp;&nbsp;&nbsp;Основной мотив исследования: близится спад сезона продаж и выручка в аптечной сети начнет падать. Необходимо найти способы адаптации к сезонному спаду продаж. Для привлечения покупателей к покупки компания собирается провести персонализированную рассылку в зависимости от платежного поведения клиентов. <br>
  <hr></hr>
Главные цели исследования:

1.  Провести классификацию пользователей

2.  Сформировать рекомендации - какой группе пользователей что предлагать.

&nbsp;&nbsp;&nbsp;&nbsp;В исследовании воспользуемся инструментом сегментации пользователей -
RFM-анализом клиентский базы аптечной сети. Данный анализ делит
пользователей на определенные группы в зависимости от давности, частоты
и общей суммы их платежей. Задача такого анализа-изучить поведение
пользователей и то, как они совершают платежи, чтобы сделать более
релевантные предложения каждой из выделенных групп.

&nbsp;&nbsp;&nbsp;&nbsp;Для исследования использовалась таблица с транзакциями по бонусной
системе "bonuscheques" базы данных Apteka, в частности были взяты
данные:

-   datetime - дата и время совершения транзакции

-   summ_with_disc - сумма чека с учетом скидок и списаний бонусов

-   card - номер бонусной карты

&nbsp;&nbsp;&nbsp;&nbsp;Если в момент покупки касса была в оффлайн-режиме, то вместо номера
карты записывается зашифрованная последовательность символов. В таком
случае номер карты силами этой базы данных никак восстановить нельзя. В
таком случае идентифицировать клиента не предоставляется возможным,
поэтому такие позиции в расчет не брались.

 <hr></hr>

<h3 align="center">

[Ссылка на дашборд](https://github.com/Liatrissa/Portfolio/blob/main/%D0%93%D0%B0%D0%BB%D0%B5%D1%80%D0%B5%D1%8F%20%D0%B4%D0%B0%D1%88%D0%B1%D0%BE%D1%80%D0%B4%D0%BE%D0%B2/RFM-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D0%BA%D0%BB%D0%B8%D0%B5%D0%BD%D1%82%D1%81%D0%BA%D0%BE%D0%B9%20%D0%B1%D0%B0%D0%B7%D1%8B%20%D0%B0%D0%BF%D1%82%D0%B5%D1%87%D0%BD%D0%BE%D0%B9%20%D1%81%D0%B5%D1%82%D0%B8.pdf) </h3>

 <hr></hr>

<h3 align="center"> 
  
[Ссылка на SQL запрос для определения RFM-сегментов](https://github.com/Liatrissa/Portfolio/blob/main/RFM-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7/RFM_%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D1%8B.sql) </h3>

  <hr></hr>
<h3 align="center">Выбор метрик для анализа </h3>

&nbsp;&nbsp;&nbsp;&nbsp;Метрики для анализа следующие:

Recency (R) - количество дней с последней покупки каждого клиента. Чем
меньше число, тем более \"свежим\" является клиент (для определения
давности платежа)

Frequency (F) - количество покупок клиента за определенный период
времени (для определения частоты покупок)

Monetary (M) - сумма потраченных клиентом денег за определенный период
времени (для определения общей суммы покупок).

&nbsp;&nbsp;&nbsp;&nbsp;Все эти три метрики рассчитываются отдельно для каждого пользователя за
выбранный период, после чего пользователям проставляется оценка по
каждой из трех метрик. Рассматриваемый период в исследовании с
12.07.2021 по 09.06.2022 гг.

 <hr></hr>

 <h3 align="center">Расчет RFM показателей </h3>
Для расчета показателя Recency (давность покупки) используется подзапрос
"transactions", в котором выбирается последняя транзакция для каждой
карты и исключаются карты,которые не имеют привязок к клиентам. Затем
вычисляется количество дней от даты последней транзакции до 09.06.2022
г. (т.к. это крайняя дата в рассматриваемом периоде).

Для расчета показателя Frequency подсчитывается общее количество покупок
(по дате) для каждой карты.

Для расчета показателя Monetary используется запрос, в котором
суммируются все суммы покупок для каждой карты.

<hr></hr>

<h3 align="center">Формирование RFM-сегментов </h3>

Для определения оптимальных пороговых значений для классификации
клиентов используем метод квантилей. Для этого нужно поочередно
упорядочить данные по каждой из метрик, а затем разделить пользователей
на равные группы. В данном исследовании будем выделять 3 класса примерно
по 33 % пользователей в каждом.

Выбор использование метода квантилей обусловлен: во-первых метод
квантилей основан на порядковых значениях, поэтому он учитывает иерархию
данных и сохраняет порядок значений в каждом классе. Во-вторых при
разбиении на три класса с использованием метода квантилей, вероятность
попадания клиентов в каждый класс будет примерно одинакова. Это
позволяет отслеживать различные типы клиентов и принимать
соответствующие меры по улучшению взаимодействия с ними.

После определения квантилей, мы применяем их для классификации клиентов
в разбивке метрик Recency (далее R), Frequency (далее F), Monetary
(далее M).

Определяем следующие классы:

-   Класс 1: метрики R до 33-го перцентиля, F, M выше 66-го перцентиля
    > (для R- с момента покупки прошло мало времени, для F- покупки
    > совершаются часто, для M- сумма покупок большая)

-   Класс 2: метрики R, F, M между 33-м и 66-м перцентилем (для R- с
    > момента покупки прошло относительно немного времени, для F-
    > покупки совершаются периодически, для M- сумма покупок средняя).

-   Класс 3: метрики R выше 66-го перцентиля, F, M до 33-го перцентиля
    > (для R- с момента покупки прошло много времени, для F- покупки
    > совершаются в основном разовые, для M- сумма покупок маленькая).

Получаем следующие классы для RFM-метрик:


| Класс |  Recency (Давность последней покупки)| Frequency (Частота покупок) |Monetary (Сумма всех покупок) |
|-------|--------------------------------------|-----------------------------|------------------------------|
| 1     | от 29 дней                           | от 6 покупок                |от 4130 рублей                |
| 2     | от 30 дней до 99 дней                | от 4 до 5 покупок           |от 1757 до 4129 рублей        |
| 3     | от 100 дней                          | до 3 покупок                |менее 1756 рублей             |


В SQL запросе (в CTE "transactions", "rfm") первоначально были
рассчитаны значения RFM-метрик для каждого пользователя, исключая
позиции в базе, в которых невозможно было идентифицировать пользователя.

Далее необходимо рассчитать оптимальные пороговые значения для
классификации клиентов, для этого можно воспользоваться функцией
percent_rank() для расчета процентного ранга(перцентиля) для каждого
значения RFM-метрик (расчет приведен в CTE "rfm_percentile").

Затем на основании полученных данных можно разбить RFM- показатели на
классы (это сделано в CTE "rfm_class"). Рассчитав оптимальные границы
для классификации клиентов можно сформировать RFM-сегменты на основе
комбинации значений Recency, Frequency и Monetary. Используем матрицу
3х3 для классификации клиентов по трём метрикам, где каждый параметр
делится на 3 вышеописанных класса. Таким образом, получим 27 различных
сегментов.

В основном блоке запроса объединили все RFM-показатели для определения
RFM-сегмента, к которому будет относится пользователь, также рассчитали
количество клиентов для каждого сегмента, это необходимо для
последующего анализа сегментов.

На основе полученных результатов RFM-анализа наблюдаем, что клиенты
аптечной сети, разделились на 27 группы, но при этом многие группы
достаточно небольшие, соответственно, есть смысл проанализировать все
получившиеся группы и целесообразнее акцентировать внимание на более
широкие группы клиентов, поэтому можно объединить некоторые
малочисленные группы со схожими группами по стратегии работы с ними.

**Анализ и классификация клиентов.**

Анализируя полученные данные, можно сказать, что клиенты аптечной сети
хоть и разделились на 27 групп, многие из них незначительные. Самые
многочисленные группы- 111, 333, 332, 233, 211, что составляет 13,5%,
13,4%, 7%, 7,5% и 6,5%, соответственно, от общего числа клиентов.
Остальные группы -- значительно меньше и составляют менее 6% от общего
количества клиентов. Следовательно, оптимальнее рассматривать более
широкие группы клиентов.

Поэтому выделим 8 логических групп:

-   Премиум клиенты, которые покупали недавно,часто обращаются и много
    > тратят

  -----------------------------------------------------------------------
  **Номер группы**     **Количество клиентов** **Название группы**
  -------------------- ----------------------- --------------------------
  111                  799                     [Премиум
                                               клиенты]{.underline}

  -----------------------------------------------------------------------

-   Постоянные клиенты, были недавно, покупают часто или средне, тратят
    > не очень много

  -----------------------------------------------------------------------
  **Номер группы**     **Количество клиентов** **Название группы**
  -------------------- ----------------------- --------------------------
  112                  109                     [Постоянные
                                               клиенты]{.underline}

  113                  13                      [Постоянные
                                               клиенты]{.underline}

  122                  264                     [Постоянные
                                               клиенты]{.underline}
  -----------------------------------------------------------------------

-   Ценные клиенты, покупают периодически и тратят много

  -----------------------------------------------------------------------
  **Номер группы**     **Количество клиентов** **Название группы**
  -------------------- ----------------------- --------------------------
  121                  143                     [Ценные
                                               клиенты]{.underline}

  211                  383                     [Ценные
                                               клиенты]{.underline}

  221                  185                     [Ценные
                                               клиенты]{.underline}
  -----------------------------------------------------------------------

-   Пассивные клиенты, покупают нерегулярно, тратят мало

  -----------------------------------------------------------------------
  **Номер группы**     **Количество клиентов** **Название группы**
  -------------------- ----------------------- --------------------------
  212                  92                      [Пассивные
                                               клиенты]{.underline}

  213                  11                      [Пассивные
                                               клиенты]{.underline}

  222                  301                     [Пассивные
                                               клиенты]{.underline}

  223                  154                     [Пассивные
                                               клиенты]{.underline}

  232                  285                     [Пассивные
                                               клиенты]{.underline}

  233                  442                     [Пассивные
                                               клиенты]{.underline}
  -----------------------------------------------------------------------

-   Крупные потерянные клиенты, покупали давно, но тратили много

  -----------------------------------------------------------------------
  **Номер группы**     **Количество клиентов** **Название группы**
  -------------------- ----------------------- --------------------------
  231                  87                      [Крупные потерянные
                                               клиенты]{.underline}

  311                  121                     [Крупные потерянные
                                               клиенты]{.underline}

  321                  148                     [Крупные потерянные
                                               клиенты]{.underline}

  331                  98                      [Крупные потерянные
                                               клиенты]{.underline}
  -----------------------------------------------------------------------

-   Потенциальные клиенты, недавно совершили первую покупку

  -----------------------------------------------------------------------
  **Номер группы**     **Количество клиентов** **Название группы**
  -------------------- ----------------------- --------------------------
  123                  93                      [Потенциальные
                                               клиенты]{.underline}

  131                  51                      [Потенциальные
                                               клиенты]{.underline}

  132                  181                     [Потенциальные
                                               клиенты]{.underline}

  133                  330                     [Потенциальные
                                               клиенты]{.underline}
  -----------------------------------------------------------------------

-   Неактивные клиенты, в прошлом много заказывали, но давно ничего не
    > покупали

  -----------------------------------------------------------------------
  **Номер группы**     **Количество клиентов** **Название группы**
  -------------------- ----------------------- --------------------------
  312                  57                      [Неактивные
                                               клиенты]{.underline}

  313                  3                       [Неактивные
                                               клиенты]{.underline}

  322                  248                     [Неактивные
                                               клиенты]{.underline}

  323                  116                     [Неактивные
                                               клиенты]{.underline}
  -----------------------------------------------------------------------

-   Ушедшие клиенты, покупали мало и давно не приобретали ничего

  -----------------------------------------------------------------------
  **Номер группы**     **Количество клиентов** **Название группы**
  -------------------- ----------------------- --------------------------
  332                  418                     [Ушедшие
                                               клиенты]{.underline}

  333                  794                     [Ушедшие
                                               клиенты]{.underline}
  -----------------------------------------------------------------------

**Выводы и рекомендации.**

В результате проведенного RFM-анализа клиентской базы аптечной сети были
сформированы 8 групп покупателей для персонализированной смс-рассылки с
целью увеличения частоты покупок и чека.

Выводы и рекомендации по каждой группе:

1\) Группа \"Премиум клиенты\" включает в себя 799 клиента. Это самая
ценная группа, так как они делают покупки с высокой частотой, тратят
большие суммы и обращаются в аптеки часто. Данная группа принесла
максимальный доход, выручка составила 46,7 % от общего числа прибыли.
"Премиум клиенты" играют ключевую роль в доходности сети аптек и важно
уделять им особое внимание.

Для рассылки, с целью удержания этой группы клиентов, рекомендуется
поблагодарить покупателей за их лояльность, предложить оформить VIP
карту со специальной программой лояльности с начислением бонусов,
например, за привлечение новых клиентов(друзей,родственников и т.д.), с
каждой покупки нового клиента можно начислять некоторое количество
бонусов. Не лишним будет предложить данной группе клиентов премиальное
обслуживание, как вариант, обслуживание вне очереди, либо при онлайн
заказе осуществлять доставку бесплатно. Это поможет продемонстрировать
значимость данной группы клиентов и укрепить их лояльность. Стоит
предоставлять им персонализированные предложения, основанные на их
частых покупках. Можно уведомлять их о новых лекарствах, аналогичных,
тем которые они в основном приобретают, сделав акцент на более лучшем
качестве препарата.

2\) Группа "Постоянные клиенты" включает в себя 386 клиентов. Необходимо
уделять внимание удержанию клиентов данной группы, так как они могут в
будущем представлять значительную долю выручки. Основная задача, как
минимум, в поддержании клиентов этой группы на этом же уровне, а как
максимум- в переводе в более перспективные группы.

Как вариант, работать над увеличением среднего чека их покупок с помощью
сопутствующих продаж, так называемых, cross-sales. Например, клиент
хочет приобрести средство от простуды, можно предложить ему еще и
лекарства для лечения горла, лекарства от насморка, витамины для
улучшения иммунитета. Также необходимо настроить на сайте аптечной сети
систему рекомендаций,если ее нет, чтобы к приобретаемым предлагались
дополняющие их товары. На сайте аптечной сети не лишним будет для
клиентов делать подборку товаров на основе истории заказов.

В целях рекомендаций стоит провести SMS-рассылку с предложениями покупки
сопутствующих товаров(к купленным ранее лекарствам), можно
проинформировать о специальных предложениях, акциях и скидках на
лекарства, которые потенциально могут быть им интересны(на основании их
прошлых покупок). Использовать программу лояльности для постоянных
клиентов, например, накопительные скидки или бонусы за каждую покупку,
чтобы стимулировать их к повторным покупкам. Можно внедрить
онлайн-консультации для постоянных клиентов, чтобы помочь им выбирать
при необходимости подходящие препараты и отвечать на возникающие
вопросы.

3\) Группа "Ценные клиенты" включает в себя 711 клиентов. Важно
сформировать долгосрочные отношения с такими клиентами, так как они
могут быть не очень частыми покупателями, но достаточно крупными. Данная
группа принесла большой процент выручки- 21,2 % от общего числа прибыли.
Необходимо поддерживать клиентов на текущем уровне, если есть
возможность, переводить в самую лучшую группу "Премиум клиентов". Для
этого надо развивать программы поощрения и привлечения, чтобы
стимулировать их на повторные покупки.

Для рассылки рекомендуется поблагодарить клиентов за предыдущие покупки
и предложить персонализированный подход (с целью оказания заботы) с
уникальными предложениями на товары, которые приобретались ранее. Кроме
того, можно пригласить на эксклюзивные мероприятия и презентации новых
продуктов, чтобы клиенты могли быть в курсе последних тенденций в
области медицины и здоровья. Можно предлагать бесплатную персональную
консультацию фармацевта и рекомендации по выбору лекарств, основанных на
их предыдущих покупках и интересах.

Не лишним будет проведение опросов среди ценных клиентов для выявления
их потребностей и предпочтений, чтобы предложить им наиболее подходящие
товары. Стоит также взаимодействовать с клиентами через различные каналы
связи(группа вк, канал в телеграм), где клиенты смогут получать
информацию о новинках и акциях.

4\) Группа "Пассивные клиенты", самая многочисленная группа, включает в
себя 1285 клиента. Данная группа принесла хороший процент выручки - 7,1%
от общего числа прибыли. На нее обязательно надо обратить внимание. Эта
группа клиентов, которые покупают нерегулярно и тратят мало. Скорее
всего, покупатели этой группы уже успели познакомиться с ассортиментом
аптечной сети, приобрели определенное количество лекарств, но возможно
еще не составили четкого мнения об аптечной сети. Чтобы понять, что не
устраивает клиентов в аптечной сети, можно организовать опрос. Возможно,
в самой аптечной сети произошли какие-либо изменения-например изменилась
ценовая политика, тогда можно предлагать клиентам аналогичные товары с
более приемлемой для них ценой.

Необходимо помочь покупателям сформировать положительный образ и
"расшевелить" еще помнящих об аптечной сети клиентов. Для этого следует
организовать им рассылку с интересными акциями и выгодными
предложениями, проходящими в аптеке. Стоит также рассмотреть предложение
скидки на повторные покупки или бонусные баллы за покупку, которые можно
будет обменять на товары в будущем. Для того, чтобы вовлечь клиента в
аптечную сеть, можно организовать розыгрыш в честь какого-либо
праздника(разыгрывать можно витамины, популярные товары, сертификаты на
будущую покупку лекарств и т.д.), а билеты на розыгрыш, к примеру, можно
заработать делая покупки лекарств на определенную n-ю сумму. Либо можно
провести мероприятия или акции, привлекающие внимание пассивных
клиентов, например, дни бесплатных консультаций фармацевта или дни
скидок на определенные категории товаров с ограниченным периодом
действия. Возможно есть смысл расширить ассортимент товаров, включая не
только лекарства, но и товары для ухода за собой, витамины, биодобавки и
т.д., чтобы привлечь больше внимания пассивных клиентов. Стоит также
внедрить персонализированный подход к клиентам, предлагая индивидуальные
скидки или специальные предложения на основе их предыдущих покупок.

5\) Группа "Крупные потерянные клиенты" включает в себя 454 клиента.
Данная группа принесла хороший процент выручки - 10,2% от общего числа
прибыли. Клиенты этой группы тратили большие суммы денег, но давно
перестали делать покупки. Первоначально надо понять причины, по которым
эти клиенты перестали покупать у вас. Возможно, они нашли другую
аптечную сеть, где им нравится обслуживание или цены. Чтобы разобраться
в причинах можно провести опрос среди этих клиентов, чтобы узнать, что
именно они хотели бы видеть в вашей аптечной сети. Может быть, у них
есть жалобы или предложения, которые могут помочь удержать их как
клиентов.

С данной группой клиентов необходимо возобновить сотрудничество. Для
этого можно организовать эксклюзивное мероприятие специально для
них(например, провести небольшую презентацию экскурс по новым лекарствам
с предоставлением специальных условий для участников), чтобы привлечь
внимание этих клиентов и продемонстрировать им, что вы цените их как
клиентов. Для рассылки можно предложить персонализированные предложения
по новым препаратам, которые потенциально могут быть им интересны(на
основе прошлых покупок), а также приглашение на эксклюзивное
мероприятие. Еще можно рассмотреть предоставления бесплатной доставки
при онлайн заказе для повторной покупки.

6\) Группа "Потенциальные клиенты" включает в себя 655 клиента. Это
клиенты, которые недавно совершили первую покупку. Можно рассказать этим
клиентам о существующей программе лояльности или бонусной системы вашей
аптечной сети, чтобы они могли получить дополнительные бонусы или скидки
при следующих покупках. Это позволит заинтересовать их на совершение
следующих покупок. Как вариант можно предоставлять клиентам возможность
бесплатной консультации с фармацевтом для ответов на вопросы о здоровье
и лекарствах. Это поможет построить доверие и убедить клиентов в вашей
заботе о их здоровье.

Для рассылки можно выбрать идею приветственной акции: предложить
клиентам специальную скидку или подарок за повторную покупку в вашей
аптечной сети в ограниченный период времени. Подарком может быть,
например, скидка на последующие покупки с лимитом во времени, либо
бесплатный товар(витамины и т.д.) при покупке лекарств на определенную
сумму денег. Это поможет внушить клиентам ощущение срочности и
стимулировать их быстрое возвращение. Стоит также привлечь данную группу
клиентов в различные каналы связи(группа вк, канал в телеграм), где
клиенты смогут получать информацию о новинках и акциях.

7\) Группа \"Неактивные клиенты\" включает в себя 424 клиента. Это
клиенты, которые в прошлом много заказывали, но давно ничего не
покупали. Для возрождения интереса этой группы клиентов можно отправить
напоминание о важности здоровья и поддержании запасов лекарств,
витаминов или других медицинских продуктов. Не лишним будет предоставить
клиентам полезную информацию о новинках в мире медицины, здоровом образе
жизни, или сезонных заболеваниях, чтобы побудить их к покупкам.

Для рассылки можно предложить специальные скидки или бонусы
исключительно для этой группы клиентов на их любимые товары(согласно
предыдущим покупкам клиентов), либо на новинки, чтобы привлечь их вновь.
Как вариант можно рассмотреть возможность предоставления приветственного
подарка или бонуса за первую покупку после долгого периода неактивности.

8\) Группа "Ушедшие клиенты" включает в себя 1212 клиента. Это полностью
потерянные потребители, которые очень давно совершили разовые недорогие
покупки и больше не возвращались в аптеку. В зависимости от целей, можно
предпринять попытку вернуть данную категорию потребителей, в этом
случае, стоит, в первую очередь, собрать обратную связь у клиентов
данной группы и выяснить, почему они перестали интересоваться продукцией
аптечной сети, что их не устраивает. Возможно, в самой аптечной сети
произошли какие-либо трансформации, -- изменилась ценовая политика,
устарел ассортимент лекарств, отсутствуют необходимые препараты,
обновился сайт и возникли проблемы с приобретением лекарств и т.д.
--причины которые оттолкнули потребителей. После качественной работы с
обратной связью, можно предложить клиентам скидку, чтобы еще раз
привлечь внимание. Возможно, ушедшие клиенты перешли к конкурентам из-за
неудовлетворительного опыта обслуживания или ценовой
конкурентоспособности. Уйдя от вас, клиенты могут забыть о вашей
аптечной сети.

В качестве рассылки можно направить дружественное напоминание этим
клиентом о вашем существовании и предложить им воспользоваться
актуальными предложениями, специальными скидками. Это может
стимулировать их вернуться и совершить новую покупку. Однако, не стоит
возлагать больших надежд, коммуникация с данной группой крайне сложная,
существует риск столкнуться с игнорированием. То есть можно попробовать
спровоцировать, чтобы вернуть в число активных. Но не настаивать, если
нет отклика, то не тратить время (дороже встанет).
